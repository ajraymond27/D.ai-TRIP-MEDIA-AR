<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>360&deg; Image</title>
    <meta name="description" content="360&deg; Image - A-Frame">
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>

    <!-- ðŸš¨ REQUIRED: QRCode generator used to show URL on non-mobile browsers -->
    <script src="https://cdn.jsdelivr.net/npm/davidshimjs-qrcodejs@0.0.2/qrcode.min.js"></script>
  </head>
  <body>
    <table>
      <tr>
        <td>
          <div id=qrcode-container>
            <div id='qrcode'>
            </div>
            <p>Point your mobile device camera here <br>to view in Augmented Reality.</p>
          </div>
  
          <model-viewer auto-rotate 
                        camera-controls 
                        shadow-intensity="1" 
                        alt="donut" 
                        background-color="#70BCD1">
                          
          </model-viewer>
        </td>
      </tr>
      <tr>
        <td>
          <div id="anchor-container">
            <a id="view-in-ar-anchor" rel="ar">
              <img />  <!-- this first child image is needed for iOS QuickLook -->
              <p>Tap to View in your space</p>
            </a>
          </div>
        </td>
      </tr>
    </table>
    <script>
      const showQRCode = () => {
        console.log("Show QRCode");
        const div = document.getElementById("qrcode-container");
        div.style.display = "block";
      };
  
      // Detect platform - if mobile platform, link to the appropriate 3D model, otherwise show a qrcode for a mobile phone to point
      // to this page
      const anchor = document.getElementById('view-in-ar-anchor');
      if (anchor.relList.supports('ar')) {
        // iOS - use usdz and QuickLook
        anchor.setAttribute('href', `https://d13wrvtzk1buxr.cloudfront.net/usdz/ayylmao.usdz`);
      } else if (/android/i.test(navigator.userAgent)) {
        // Android - use glb and model-viewer
        const intent = `intent://arvr.google.com/scene-viewer/1.0?file=https://d13wrvtzk1buxr.cloudfront.net/glb/ayylmao.glb&mode=ar_only&title=AR%20Product%20Preview Demo#Intent;scheme=https;package=com.google.android.googlequicksearchbox;action=android.intent.action.VIEW;S.browser_fallback_url=${window.location.href};end;`
        anchor.setAttribute('href', intent);
      } else {
        // on Desktop - show QR code to this page to access on mobile
        console.log(`Creating QRCode for ${window.location.href}`);
        const div = document.querySelector('#qrcode');
        const qrcode = new QRCode(div, {width:250, height:250});
        qrcode.makeCode(window.location.href);
        anchor.setAttribute('onclick', 'showQRCode()');
      }
  
      const modelviewer = document.querySelector('model-viewer');
      modelviewer.setAttribute('src', `https://d13wrvtzk1buxr.cloudfront.net/glb/ayylmao.glb`);
    </script>    
  </body>
</html>